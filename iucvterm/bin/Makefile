#! /usr/bin/make -f

include ../../common.mak


BIN_SCRIPTS = ts-shell
SBIN_SCRIPTS = chiucvallow

SCRIPTS = $(BIN_SCRIPTS) $(SBIN_SCRIPTS)


all:
check:
install: $(SCRIPTS)
	for prg in $(BIN_SCRIPTS); do \
	  $(INSTALL) -g $(GROUP) -o $(OWNER) -m 755 $$prg $(USRBINDIR) ; \
	done
	for prg in $(SBIN_SCRIPTS); do \
	  $(INSTALL) -g $(GROUP) -o $(OWNER) -m 755 $$prg $(USRSBINDIR) ; \
	done
	$(INSTALL) -g $(GROUP) -o $(OWNER) -d $(INSTROOT)/var/log/ts-shell
	ln -f -s chiucvallow $(USRSBINDIR)/lsiucvallow

clean:
	-rm -f *.o $(SCRIPTS)


%: %.in
	real_usrbin=`echo $(USRBINDIR) |sed 's#^$(INSTROOT)##'` ; \
	my_sysconf=`echo $(SYSCONFDIR)/iucvterm |sed 's#^$(INSTROOT)##'` ; \
	cat $< \
	  |sed -e "s#@sysconf_path@#$$my_sysconf#g" \
	       -e "s#@iucvconn_path@#$$real_usrbin#g" \
	       -e 's#@S390_TOOLS_RELEASE@#$(S390_TOOLS_RELEASE)#g' \
	> $@

perl: ts-shell
	perl -c $<

scripts: $(SCRIPTS)

.PHONY: install clean perl
